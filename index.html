<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Minimal Photo Booth</title>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --blue:#b0e5ff;
  --yellow:#ffd54f;
  --pink:#ffb6c1;
  --text:#224455;
}
html,body{
  margin:0;height:100%;
  font-family:"Quicksand","Kanit",sans-serif;
  background:var(--blue);
  display:flex;align-items:center;justify-content:center;
  color:var(--text);
}
.booth{
  width:360px;max-width:90%;
  background:white;
  border-radius:24px;
  box-shadow:0 8px 20px rgba(0,0,0,0.12);
  padding:18px;
  display:flex;flex-direction:column;align-items:center;
}
.title{font-size:20px;font-weight:700;margin-bottom:12px;color:var(--text);}
.frame{
  width:100%;
  aspect-ratio:3/4;
  border-radius:18px;
  overflow:hidden;
  position:relative;
  background:var(--pink);
  display:flex;align-items:center;justify-content:center;
}
#video{
  width:100%;height:100%;
  object-fit:cover;
  transform:scaleX(-1);
}
.countdown{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  font-size:64px;font-weight:900;
  color:white;text-shadow:0 4px 12px rgba(0,0,0,0.4);
  pointer-events:none;
}
.flash{
  position:absolute;inset:0;background:white;
  opacity:0;transition:opacity 0.25s;
  pointer-events:none;
}
.flash.show{opacity:0.8;}
.controls{margin-top:18px;display:flex;flex-direction:column;align-items:center;}
/* ปุ่มชัตเตอร์กลม */
#shutter{
  width:90px;height:90px;
  border-radius:50%;
  background:radial-gradient(circle at 30% 30%, var(--yellow) 0%, #f0c200 100%);
  border:6px solid white;
  box-shadow:0 4px 14px rgba(0,0,0,0.25);
  cursor:pointer;
  transition:transform 0.1s;
}
#shutter:active{transform:scale(0.92);}
.thumb-row{
  margin-top:18px;
  display:flex;justify-content:space-between;width:100%;
}
.thumb{
  width:32%;aspect-ratio:3/4;
  border-radius:12px;
  background:#f7faff;
  overflow:hidden;
  border:3px solid var(--pink);
}
.thumb img{width:100%;height:100%;object-fit:cover;}
.actions{margin-top:16px;}
.download-btn{
  padding:10px 20px;
  border:3px solid var(--yellow);
  border-radius:20px;
  background:transparent;
  font-weight:700;
  color:var(--text);
  cursor:pointer;
}
</style>
</head>
<body>
<div class="booth">
  <div class="title">Minimal Photo Booth</div>
  <div class="frame">
    <video id="video" autoplay playsinline></video>
    <div class="countdown" id="countdown"></div>
    <div class="flash" id="flash"></div>
  </div>

  <div class="controls">
    <button id="shutter"></button>
    <div class="thumb-row">
      <div class="thumb" id="t1"></div>
      <div class="thumb" id="t2"></div>
      <div class="thumb" id="t3"></div>
    </div>
    <div class="actions">
      <button id="downloadBtn" class="download-btn">ดาวน์โหลดรูป</button>
    </div>
  </div>
</div>

<audio id="snapSound" src="https://cdn.jsdelivr.net/gh/naptha/talkdemo/snap.mp3" preload="auto"></audio>

<script>
(async ()=>{
  const video=document.getElementById('video');
  const shutter=document.getElementById('shutter');
  const countdown=document.getElementById('countdown');
  const flash=document.getElementById('flash');
  const thumbs=[t1,t2,t3];
  const snap=document.getElementById('snapSound');
  let captures=[null,null,null], idx=0;

  // เปิดกล้อง
  try{
    const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});
    video.srcObject=stream;
  }catch(e){alert("ไม่สามารถเปิดกล้องได้");}

  function capture(){
    const c=document.createElement('canvas');
    c.width=video.videoWidth; c.height=video.videoHeight;
    const ctx=c.getContext('2d');
    ctx.translate(c.width,0);ctx.scale(-1,1);
    ctx.drawImage(video,0,0,c.width,c.height);
    return c.toDataURL("image/png");
  }

  async function takeShot(){
    if(idx>=3) return;
    for(let i=3;i>0;i--){
      countdown.textContent=i;
      await new Promise(r=>setTimeout(r,700));
    }
    countdown.textContent="";
    snap.play().catch(()=>{});
    flash.classList.add("show");
    setTimeout(()=>flash.classList.remove("show"),200);
    const img=capture();
    captures[idx]=img;
    thumbs[idx].innerHTML=`<img src="${img}">`;
    idx++;
  }

  shutter.addEventListener('click',takeShot);

  // ดาวน์โหลดรวม 3 ช่อง (พื้นหลังฟ้า/เหลือง/ชมพู minimal)
  document.getElementById('downloadBtn').addEventListener('click',async()=>{
    if(!captures.some(Boolean)){alert('ยังไม่ได้ถ่าย');return;}
    const w=1200,h=1800;
    const c=document.createElement('canvas');
    c.width=w; c.height=h;
    const ctx=c.getContext('2d');
    ctx.fillStyle="#b0e5ff";
    ctx.fillRect(0,0,w,h);

    // 3 ช่อง
    const margin=60,gap=30;
    const boxW=w-2*margin, boxH=(h-2*margin - 2*gap)/3;
    for(let i=0;i<3;i++){
      const y=margin + i*(boxH+gap);
      ctx.fillStyle="#ffffff";
      ctx.roundRect(margin,y,boxW,boxH,20);
      ctx.fill();
      if(captures[i]){
        const img=await loadImg(captures[i]);
        const ratio=Math.max(boxW/img.width, boxH/img.height);
        const iw=img.width*ratio, ih=img.height*ratio;
        ctx.drawImage(img,margin+(boxW-iw)/2,y+(boxH-ih)/2,iw,ih);
      }
    }

    // ดาว/เมฆแบบมินิมัล
    const colors=["#ffd54f","#ffb6c1","#ffffff99"];
    for(let i=0;i<20;i++){
      ctx.save();
      ctx.fillStyle=colors[Math.floor(Math.random()*colors.length)];
      const x=Math.random()*w, y=Math.random()*h, r=Math.random()*15+5;
      ctx.beginPath();
      for(let j=0;j<5;j++){
        const a=(Math.PI*2*j)/5 - Math.PI/2;
        ctx.lineTo(x+Math.cos(a)*r,y+Math.sin(a)*r);
        const ia=a+Math.PI/5;
        ctx.lineTo(x+Math.cos(ia)*r*0.5,y+Math.sin(ia)*r*0.5);
      }
      ctx.closePath();ctx.fill();
      ctx.restore();
    }

    const a=document.createElement('a');
    a.href=c.toDataURL("image/png");
    a.download="minimal_photobooth.png";
    a.click();
  });

  function loadImg(src){
    return new Promise((res,rej)=>{
      const i=new Image();
      i.onload=()=>res(i);
      i.onerror=rej;
      i.src=src;
    });
  }
})();
</script>
</body>
</html>
