<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SENA BOOTH</title>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@700&display=swap" rel="stylesheet">
<style>
:root{
  --blue:#b0e5ff;
  --yellow:#ffd54f;
  --pink:#ffb6c1;
  --text:#223344;
}
html,body{
  margin:0;padding:0;height:100%;
  background:var(--blue);
  display:flex;align-items:center;justify-content:center;
  font-family:"Quicksand",sans-serif;
}
.booth{
  width:90vw;max-width:800px;
  background:#fff;
  border:10px solid var(--pink);
  border-radius:30px;
  box-shadow:0 8px 24px rgba(0,0,0,0.2);
  padding:20px;
  box-sizing:border-box;
  text-align:center;
}
.title{
  font-size:2rem;
  font-weight:700;
  color:var(--text);
  margin-bottom:12px;
}
.frame{
  width:100%;
  aspect-ratio:3/4;
  border:8px solid var(--yellow);
  border-radius:20px;
  overflow:hidden;
  position:relative;
  background:#eee;
}
#video{
  width:100%;height:100%;
  object-fit:cover;
  transform:scaleX(-1);
}
.countdown{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  font-size:5rem;font-weight:900;
  color:white;text-shadow:0 4px 12px rgba(0,0,0,0.4);
}
.flash{
  position:absolute;inset:0;background:white;
  opacity:0;transition:opacity 0.25s;
}
.flash.show{opacity:0.8;}
.controls{margin-top:16px;}
#shutter{
  width:90px;height:90px;
  border-radius:50%;
  background:radial-gradient(circle at 30% 30%, var(--yellow) 0%, #f0c200 100%);
  border:6px solid white;
  box-shadow:0 4px 14px rgba(0,0,0,0.25);
  cursor:pointer;
}
.thumb-row{
  margin-top:18px;
  display:flex;flex-wrap:wrap;gap:8px;justify-content:center;
}
.thumb{
  width:30%;min-width:90px;
  aspect-ratio:3/4;
  border-radius:12px;
  border:4px solid var(--pink);
  overflow:hidden;
  background:#fafafa;
}
.thumb img{width:100%;height:100%;object-fit:cover;}
.download-btn{
  margin-top:16px;
  padding:10px 20px;
  border:3px solid var(--yellow);
  border-radius:20px;
  background:transparent;
  font-weight:700;
  color:var(--text);
  cursor:pointer;
}
</style>
</head>
<body>
<div class="booth">
  <div class="title">SENA BOOTH</div>
  <div class="frame">
    <video id="video" autoplay playsinline></video>
    <div class="countdown" id="countdown"></div>
    <div class="flash" id="flash"></div>
  </div>
  <div class="controls">
    <button id="shutter"></button>
    <div class="thumb-row">
      <div class="thumb" id="t1"></div>
      <div class="thumb" id="t2"></div>
      <div class="thumb" id="t3"></div>
    </div>
    <button id="downloadBtn" class="download-btn">ดาวน์โหลดรูป</button>
  </div>
</div>

<audio id="snapSound" src="https://cdn.jsdelivr.net/gh/naptha/talkdemo/snap.mp3" preload="auto"></audio>

<script>
(async ()=>{
  const video=document.getElementById('video');
  const shutter=document.getElementById('shutter');
  const countdown=document.getElementById('countdown');
  const flash=document.getElementById('flash');
  const thumbs=[t1,t2,t3];
  const snap=document.getElementById('snapSound');
  let captures=[null,null,null];

  // เปิดกล้อง
  try{
    const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});
    video.srcObject=stream;
  }catch(e){alert("ไม่สามารถเปิดกล้องได้");}

  function capture(){
    const c=document.createElement('canvas');
    c.width=video.videoWidth; c.height=video.videoHeight;
    const ctx=c.getContext('2d');
    ctx.translate(c.width,0);ctx.scale(-1,1);
    ctx.drawImage(video,0,0,c.width,c.height);
    return c.toDataURL("image/png");
  }

  // ถ่าย 3 ช็อตต่อเนื่อง
  async function takeThreeShots(){
    captures=[null,null,null];
    for(let i=0;i<3;i++){
      for(let j=3;j>0;j--){
        countdown.textContent=j;
        await new Promise(r=>setTimeout(r,600));
      }
      countdown.textContent="";
      snap.play().catch(()=>{});
      flash.classList.add("show");
      setTimeout(()=>flash.classList.remove("show"),200);
      const img=capture();
      captures[i]=img;
      thumbs[i].innerHTML=`<img src="${img}">`;
      if(i<2) await new Promise(r=>setTimeout(r,1000));
    }
  }
  shutter.addEventListener('click',takeThreeShots);

  document.getElementById('downloadBtn').addEventListener('click',async()=>{
    if(!captures[0]){alert('ยังไม่ได้ถ่าย');return;}
    const w=1200,h=1800;
    const c=document.createElement('canvas');
    c.width=w; c.height=h;
    const ctx=c.getContext('2d');

    // พื้นหลัง + กรอบ
    ctx.fillStyle="#b0e5ff";
    ctx.fillRect(0,0,w,h);
    ctx.lineWidth=30;
    ctx.strokeStyle="#ffb6c1";
    ctx.strokeRect(15,15,w-30,h-30);

    // หัวเรื่อง SENA BOOTH
    ctx.fillStyle="#223344";
    ctx.font="bold 72px Quicksand";
    ctx.textAlign="center";
    ctx.fillText("SENA BOOTH", w/2, 90);

    // 3 ช่องรูป
    const margin=70, gap=40;
    const boxW=w-2*margin, boxH=(h-220 - 2*gap)/3;
    for(let i=0;i<3;i++){
      const y=150 + i*(boxH+gap);
      ctx.strokeStyle="#ffd54f";
      ctx.lineWidth=12;
      ctx.strokeRect(margin,y,boxW,boxH);
      if(captures[i]){
        const img=await loadImg(captures[i]);
        const ratio=Math.max(boxW/img.width, boxH/img.height);
        const iw=img.width*ratio, ih=img.height*ratio;
        ctx.drawImage(img,margin+(boxW-iw)/2,y+(boxH-ih)/2,iw,ih);
      }
    }

    const a=document.createElement('a');
    a.href=c.toDataURL("image/png");
    a.download="sena_booth.png";
    a.click();
  });

  function loadImg(src){
    return new Promise((res,rej)=>{
      const i=new Image();
      i.onload=()=>res(i);
      i.onerror=rej;
      i.src=src;
    });
  }
})();
</script>
</body>
</html>
