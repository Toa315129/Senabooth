<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<title>SENA BOOTH — Photo Booth</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- ฟอนต์น่ารัก -->
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
<style>
  body {
    margin:0;
    font-family: 'Fredoka One', cursive;
    background:linear-gradient(180deg,#fff,#fff7fb);
    display:flex;justify-content:center;align-items:center;
    min-height:100vh;
  }
  .wrap {
    background:#fffdf6;
    border-radius:20px;
    box-shadow:0 8px 24px rgba(0,0,0,0.15);
    padding:20px;
    width:95%;max-width:900px;
    text-align:center;
  }
  h1 {
    margin:0 0 12px;
    font-size:36px;
    color:#ff61a5;
  }
  .video-wrap {
    position:relative;
    width:100%;padding-top:56.25%;
    background:#eee;border-radius:12px;overflow:hidden;
    border:6px solid #ffeef6;margin-bottom:10px;
  }
  video {
    position:absolute;left:0;top:0;width:100%;height:100%;
    object-fit:cover;transform:scaleX(-1);
  }
  .overlay {
    position:absolute;inset:0;
    display:flex;align-items:center;justify-content:center;
    font-size:96px;color:white;text-shadow:0 6px 18px rgba(0,0,0,.5);
    opacity:0;transition:.2s;
  }
  button {
    font-family:'Fredoka One',cursive;
    background:#ff8fb1;border:none;
    color:white;font-size:20px;
    padding:10px 20px;margin:6px;border-radius:10px;
    cursor:pointer;box-shadow:0 4px 12px rgba(255,100,150,.25);
  }
  button:disabled{opacity:.5}
  .preview img {
    max-width:100%;margin-top:15px;
    border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.15);
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>SENA BOOTH</h1>
  <div class="video-wrap" id="videoWrap">
    <video id="video" autoplay playsinline></video>
    <div class="overlay" id="overlay"></div>
  </div>
  <div>
    <button id="startBtn">กดเริ่มต้น</button>
    <button id="retakeBtn" disabled>ถ่ายใหม่</button>
    <button id="downloadBtn" disabled>ดาวน์โหลด</button>
  </div>
  <div class="preview" id="stripPreview">ยังไม่มีรูป</div>
</div>

<script>
const startBtn=document.getElementById('startBtn');
const retakeBtn=document.getElementById('retakeBtn');
const downloadBtn=document.getElementById('downloadBtn');
const video=document.getElementById('video');
const overlay=document.getElementById('overlay');
const stripPreview=document.getElementById('stripPreview');

let stream=null;
let photos=[];
const photoW=600, photoH=400;
const gap=30, totalShots=3;

async function startCamera(){
  if(stream) return;
  stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:false});
  video.srcObject=stream;
}

function showCount(n){overlay.textContent=n;overlay.style.opacity=1;}
function hideCount(){overlay.style.opacity=0;}

function captureFrame(){
  const c=document.createElement('canvas');
  c.width=photoW;c.height=photoH;
  const ctx=c.getContext('2d');
  ctx.scale(-1,1);
  ctx.drawImage(video,-photoW,0,photoW,photoH);
  return c.toDataURL('image/png');
}

function buildStrip(images){
  const canvas=document.createElement('canvas');
  canvas.width=1200; // 4 นิ้วที่ 300dpi
  canvas.height=1800; // 6 นิ้วที่ 300dpi
  const ctx=canvas.getContext('2d');
  ctx.fillStyle='#fffef7';ctx.fillRect(0,0,canvas.width,canvas.height);

  images.forEach((src,i)=>{
    const img=new Image();img.src=src;
    img.onload=()=>{
      const x=(canvas.width-photoW)/2;
      const y=150+i*(photoH+gap);
      ctx.drawImage(img,x,y,photoW,photoH);
      ctx.strokeStyle='#ff8fb1';ctx.lineWidth=8;
      ctx.strokeRect(x,y,photoW,photoH);
      ctx.fillStyle='#ff61a5';ctx.font='48px "Fredoka One"';
      ctx.textAlign='center';
      ctx.fillText('SENA BOOTH',canvas.width/2,y+photoH+55);

      stripPreview.innerHTML='';
      const out=new Image();
      out.src=canvas.toDataURL('image/png');
      stripPreview.appendChild(out);

      downloadBtn.onclick=()=>{
        const a=document.createElement('a');
        a.href=canvas.toDataURL('image/png');
        a.download='senabooth.png';
        a.click();
      };
    }
  });
}

async function takeShots(){
  photos=[];startBtn.disabled=true;downloadBtn.disabled=true;retakeBtn.disabled=true;
  for(let i=0;i<totalShots;i++){
    for(let n=3;n>=1;n--){
      showCount(n);await new Promise(r=>setTimeout(r,700));
    }
    hideCount();await new Promise(r=>setTimeout(r,200));
    photos.push(captureFrame());
    await new Promise(r=>setTimeout(r,400));
  }
  buildStrip(photos);
  retakeBtn.disabled=false;downloadBtn.disabled=false;startBtn.disabled=false;
}

startBtn.onclick=async()=>{await startCamera();takeShots();}
retakeBtn.onclick=()=>{stripPreview.textContent="ยังไม่มีรูป";photos=[];downloadBtn.disabled=true;retakeBtn.disabled=true;}
</script>
</body>
</html>
