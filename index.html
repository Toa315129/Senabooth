<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Photo Booth @saphasena68</title>

<!-- ฟอนต์น่ารัก -->
<link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">

<style>
  :root{
    --frame-blue: #bfeeff;
    --accent-yellow: #ffd54f;
    --card-bg: #ffffff;
    --shadow: 0 8px 20px rgba(0,0,0,0.15);
    --radius: 16px;
    --text: #0b3b5a;
  }
  html,body{height:100%;margin:0;font-family:"Kanit","Inter",system-ui,sans-serif;background:#f3f7fb;color:var(--text);}
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;box-sizing:border-box;}
  .booth{width:380px;background:linear-gradient(180deg,var(--card-bg),#f7fbff);border-radius:18px;box-shadow:var(--shadow);padding:14px;}

  .title{
    text-align:center;
    font-family:'Patrick Hand', cursive;
    font-size:32px;
    margin-bottom:8px;
    color:var(--text);
  }

  .frame-preview{width:100%;background:var(--frame-blue);border-radius:12px;padding:8px;box-sizing:border-box;position:relative;overflow:hidden;aspect-ratio:2/3;display:flex;align-items:center;justify-content:center;}
  #video{width:92%;border-radius:8px;background:black;transform:scaleX(-1);}
  .controls{margin-top:12px;display:flex;gap:8px;justify-content:center;}
  button{background:var(--accent-yellow);border:0;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,0.12);}
  button.secondary{background:#e6f3ff;color:var(--text);font-weight:600;}
  .thumbs{margin-top:12px;display:flex;flex-direction:column;gap:8px;align-items:center;}
  .thumb-row{width:92%;display:flex;gap:8px;justify-content:space-between;}
  .thumb{width:30%;background:white;border-radius:8px;overflow:hidden;height:80px;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 14px rgba(10,30,60,0.06);}
  .thumb img{width:100%;height:100%;object-fit:cover;border-radius:8px;}
  .countdown{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:64px;font-weight:900;color:rgba(255,255,255,0.95);text-shadow:0 6px 18px rgba(0,0,0,0.5);pointer-events:none;}
  .small-note{font-size:12px;color:#334e6b;text-align:center;margin-top:8px;}
  .actions{display:flex;gap:8px;justify-content:center;margin-top:8px;}
  .download-btn{background:#4d9cff;color:white;padding:8px 10px;border-radius:10px;border:0;font-weight:700;}
  @media (min-width:700px){.booth{width:480px;}}
</style>
</head>
<body>
<div class="wrap">
  <div class="booth" role="application" aria-label="photo booth">
    
    <div class="title">Photo Booth @saphasena68</div>

    <div class="frame-preview" id="framePreview">
      <video id="video" autoplay playsinline></video>
      <div class="countdown" id="countdown" style="display:none;"></div>
      <!-- ดาว -->
      <svg style="position:absolute;left:6px;top:8px;opacity:0.9" width="48" height="48" viewBox="0 0 24 24"><path d="M12 2l2.5 6 6.5.5-5 4 1.5 6-5.5-3.5L6 19l1.5-6-5-4 6.5-.5L12 2z" fill="#ffd54f"/></svg>
      <svg style="position:absolute;right:10px;bottom:12px;opacity:0.9" width="32" height="32" viewBox="0 0 24 24"><path d="M12 2l2.5 6 6.5.5-5 4 1.5 6-5.5-3.5L6 19l1.5-6-5-4 6.5-.5L12 2z" fill="#ffd54f"/></svg>
    </div>

    <div class="controls">
      <button id="startBtn">เริ่มถ่าย (3 รูป)</button>
      <button id="retakeBtn" class="secondary">เริ่มใหม่</button>
      <button id="toggleBtn" class="secondary">สลับกล้อง</button>
    </div>

    <div class="thumbs" aria-live="polite">
      <div class="thumb-row">
        <div class="thumb" id="t1"><span style="opacity:0.45;">1</span></div>
        <div class="thumb" id="t2"><span style="opacity:0.45;">2</span></div>
        <div class="thumb" id="t3"><span style="opacity:0.45;">3</span></div>
      </div>
      <div class="small-note">ภาพตัวอย่าง 3 ช่อง (แนวตั้ง) • ขนาดส่งออก 4×6 นิ้ว (1200×1800 px)</div>
      <div class="actions">
        <button id="downloadBtn" class="download-btn">ดาวน์โหลด 4x6</button>
      </div>
    </div>
  </div>
</div>

<script>
let video=document.getElementById("video"),
    startBtn=document.getElementById("startBtn"),
    retakeBtn=document.getElementById("retakeBtn"),
    toggleBtn=document.getElementById("toggleBtn"),
    downloadBtn=document.getElementById("downloadBtn"),
    countdownEl=document.getElementById("countdown"),
    thumbs=[document.getElementById("t1"),document.getElementById("t2"),document.getElementById("t3")],
    captured=[], currentStream=null, currentFacing="user";

// เสียงแชะ
const snapSound=new Audio("https://actions.google.com/sounds/v1/camera/camera_click.ogg");

async function initCamera(facing="user"){
  if(currentStream){
    currentStream.getTracks().forEach(t=>t.stop());
  }
  try{
    currentStream=await navigator.mediaDevices.getUserMedia({video:{facingMode:facing}});
    video.srcObject=currentStream;
    currentFacing=facing;
  }catch(e){alert("ไม่พบกล้อง: "+e);}
}
initCamera();

toggleBtn.onclick=()=>{initCamera(currentFacing==="user"?"environment":"user");};

async function countdown(sec){
  countdownEl.style.display="flex";
  for(let i=sec;i>0;i--){
    countdownEl.textContent=i;
    await new Promise(r=>setTimeout(r,1000));
  }
  countdownEl.style.display="none";
}

async function takePhoto(){
  let canvas=document.createElement("canvas");
  canvas.width=video.videoWidth;canvas.height=video.videoHeight;
  canvas.getContext("2d").drawImage(video,0,0);
  snapSound.play();
  return canvas.toDataURL("image/jpeg");
}

startBtn.onclick=async()=>{
  captured=[];
  thumbs.forEach((t,i)=>t.innerHTML="<span style='opacity:0.45;'>"+(i+1)+"</span>");
  for(let i=0;i<3;i++){
    await countdown(3);
    let img=await takePhoto();
    captured.push(img);
    thumbs[i].innerHTML="<img src='"+img+"'/>";
  }
};

retakeBtn.onclick=()=>{captured=[];thumbs.forEach((t,i)=>t.innerHTML="<span style='opacity:0.45;'>"+(i+1)+"</span>");};

downloadBtn.onclick=()=>{
  if(captured.length<3){alert("ถ่ายให้ครบ 3 รูปก่อนค่ะ");return;}
  let canvas=document.createElement("canvas");
  canvas.width=1200;canvas.height=1800;
  let ctx=canvas.getContext("2d");
  ctx.fillStyle="#bfeeff";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle="#0b3b5a";
  ctx.font="48px 'Patrick Hand'";
  ctx.textAlign="center";
  ctx.fillText("Photo Booth @saphasena68",canvas.width/2,70);

  let slotW=1000, slotH=500, x=100, y=150, gap=50;
  captured.forEach((src,i)=>{
    let img=new Image();img.src=src;
    img.onload=()=>{ctx.drawImage(img,x,y+i*(slotH+gap),slotW,slotH);};
  });

  setTimeout(()=>{
    let link=document.createElement("a");
    link.download="photobooth_4x6.jpg";
    link.href=canvas.toDataURL("image/jpeg",0.95);
    link.click();
  },800);
};
</script>
</body>
</html>
