<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Photo Booth @saphasena68</title>
<style>
  body{
    margin:0; font-family:'Nunito',sans-serif; background:#f0f8ff;
    display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:100vh;
  }
  .booth{
    position:relative; width:360px; padding:16px;
    background:#fff; border-radius:16px; 
    box-shadow:0 6px 20px rgba(0,0,0,0.2);
    border:6px solid #87cefa;
    overflow:hidden;
  }
  h2{
    text-align:center; margin:0 0 8px; color:#333;
    font-family:'Nunito', sans-serif;
    font-size:20px; font-weight:700;
  }
  video{ width:100%; border-radius:12px; }
  .countdown{
    position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
    font-size:72px; font-weight:bold; color:#fff; 
    text-shadow:0 0 20px #000;
    display:none; pointer-events:none;
  }
  .thumbs{ display:flex; justify-content:space-between; margin-top:10px; }
  .thumb{
    width:30%; aspect-ratio:3/4; background:#e0f7ff; border-radius:8px;
    display:flex; align-items:center; justify-content:center;
    font-size:22px; font-weight:bold; color:#555; overflow:hidden;
    position:relative; box-shadow:inset 0 0 4px rgba(0,0,0,0.1);
    transition:all .3s;
  }
  .thumb img{ width:100%; height:100%; object-fit:cover; border-radius:8px; }
  .thumb.captured{
    animation: pop 0.4s ease;
    box-shadow: 0 0 0 4px #ffd54f inset, 0 0 12px rgba(255,213,79,0.8);
  }
  .thumb.next{
    animation: blink 1s infinite;
    box-shadow: 0 0 8px rgba(255,213,79,0.7);
  }
  @keyframes pop{
    0%{transform:scale(0.9);opacity:0.5;}
    70%{transform:scale(1.05);opacity:1;}
    100%{transform:scale(1);}
  }
  @keyframes blink{
    0%,100%{opacity:1;}
    50%{opacity:0.4;}
  }
  .controls{ margin-top:10px; text-align:center; }
  button{
    background:#87cefa; border:none; padding:10px 18px;
    border-radius:20px; font-size:15px; cursor:pointer; margin:4px;
    font-family:'Nunito',sans-serif;
  }
  button:disabled{opacity:0.5; cursor:not-allowed;}
  .stars{
    position:absolute; inset:0; pointer-events:none; overflow:hidden;
  }
  .star{
    position:absolute; background:yellow; border-radius:50%;
    opacity:0.8; animation: twinkle 2s infinite ease-in-out alternate;
  }
  @keyframes twinkle{
    from{transform:scale(0.8);opacity:0.6;}
    to{transform:scale(1.3);opacity:1;}
  }
</style>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="booth">
    <h2>üì∏ Photo Booth @saphasena68</h2>
    <video id="video" autoplay playsinline></video>
    <div id="countdown" class="countdown"></div>
    <div class="thumbs">
      <div class="thumb">1</div>
      <div class="thumb">2</div>
      <div class="thumb">3</div>
    </div>
    <div class="controls">
      <button id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ñ‡πà‡∏≤‡∏¢</button>
      <button id="retakeBtn" disabled>‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</button>
      <button id="downloadBtn" disabled>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</button>
    </div>
    <div class="stars" id="stars"></div>
  </div>

  <!-- ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏ä‡∏∞ -->
  <audio id="shutterSound" preload="auto">
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_17808e58d2.mp3?filename=camera-shutter-click-03-10769.mp3" type="audio/mp3">
  </audio>

<script>
const video=document.getElementById('video');
const startBtn=document.getElementById('startBtn');
const retakeBtn=document.getElementById('retakeBtn');
const downloadBtn=document.getElementById('downloadBtn');
const countdown=document.getElementById('countdown');
const thumbs=[...document.querySelectorAll('.thumb')];
const stars=document.getElementById('stars');
const shutterSound=document.getElementById('shutterSound');
let captures=[];

// ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
navigator.mediaDevices.getUserMedia({video:true}).then(stream=>{
  video.srcObject=stream;
});

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡∏≤‡∏ß‡∏™‡∏∏‡πà‡∏°
function makeStars(){
  for(let i=0;i<40;i++){
    const s=document.createElement('div');
    const size=Math.random()*6+3;
    s.className='star';
    s.style.width=s.style.height=size+'px';
    s.style.left=Math.random()*100+'%';
    s.style.top=Math.random()*100+'%';
    s.style.animationDelay=(Math.random()*2)+'s';
    stars.appendChild(s);
  }
}
makeStars();

// countdown
function showCountdown(n){countdown.style.display='block';countdown.textContent=n;}
function hideCountdown(){countdown.style.display='none';}

// capture frame
function captureFrame(){
  const c=document.createElement('canvas');
  c.width=video.videoWidth; c.height=video.videoHeight;
  c.getContext('2d').drawImage(video,0,0,c.width,c.height);
  return c.toDataURL('image/jpeg');
}

// ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå flash
function doFlash(){
  const flash=document.createElement('div');
  flash.style.position='fixed';flash.style.inset='0';
  flash.style.background='white';flash.style.opacity='0.95';
  flash.style.transition='opacity 170ms';flash.style.zIndex='999';
  document.body.appendChild(flash);
  setTimeout(()=>{flash.style.opacity='0';setTimeout(()=>flash.remove(),200);},120);
}

// ‡∏ñ‡πà‡∏≤‡∏¢ 3 ‡∏£‡∏π‡∏õ
async function takeThreeShots(){
  startBtn.disabled = true; retakeBtn.disabled = true;
  captures = [null,null,null];
  thumbs.forEach((el,i)=>{ el.classList.remove('captured','next'); el.innerHTML=`<span style="opacity:0.45;">${i+1}</span>` });

  for(let i=0;i<3;i++){
    thumbs[i].classList.add('next');
    for(let s=3;s>=1;s--){ showCountdown(s); await new Promise(r=>setTimeout(r,800)); }
    hideCountdown();
    thumbs[i].classList.remove('next');

    // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á + flash
    shutterSound.currentTime=0; shutterSound.play();
    doFlash();

    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
    const data=captureFrame(); captures[i]=data;
    thumbs[i].innerHTML=`<img src="${data}">`;
    thumbs[i].classList.add('captured');

    await new Promise(r=>setTimeout(r,600));
  }
  startBtn.disabled = false; retakeBtn.disabled = false; downloadBtn.disabled = false;
}

// ‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
downloadBtn.addEventListener('click',async()=>{
  if(captures.length<3) return;
  const w=1200,h=1800;
  const canvas=document.createElement('canvas');
  canvas.width=w;canvas.height=h;
  const ctx=canvas.getContext('2d');

  // background
  ctx.fillStyle='#f0f8ff'; ctx.fillRect(0,0,w,h);

  // stars
  for(let i=0;i<60;i++){
    const size=Math.random()*10+4;
    ctx.fillStyle='rgba(255,223,0,'+(0.5+Math.random()*0.5)+')';
    ctx.beginPath();
    ctx.arc(Math.random()*w,Math.random()*h,size,0,Math.PI*2);
    ctx.fill();
  }

  // ‡∏Å‡∏£‡∏≠‡∏ö‡∏£‡∏≠‡∏ö‡∏ô‡∏≠‡∏Å
  ctx.lineWidth=20; ctx.strokeStyle='#87cefa';
  ctx.strokeRect(10,10,w-20,h-20);

  // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
  ctx.fillStyle='#333';
  ctx.font='bold 48px Nunito';
  ctx.textAlign='center';
  ctx.fillText('üì∏ Photo Booth @saphasena68',w/2,70);

  const margin=80; const photoW=w-2*margin; const singleH=(h-220)/3;
  for(let i=0;i<3;i++){
    const y=120+i*singleH+20*i;
    await drawImageInFrame(ctx,captures[i],margin,y,photoW,singleH,20);
  }

  const link=document.createElement('a');
  link.download='photobooth.png';
  link.href=canvas.toDataURL('image/png');
  link.click();
});

function roundRect(ctx,x,y,width,height,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.lineTo(x+width-r,y);
  ctx.quadraticCurveTo(x+width,y,x+width,y+r);
  ctx.lineTo(x+width,y+height-r);
  ctx.quadraticCurveTo(x+width,y+height,x+width-r,y+height);
  ctx.lineTo(x+r,y+height);
  ctx.quadraticCurveTo(x,y+height,x,y+height-r);
  ctx.lineTo(x,y+r);
  ctx.quadraticCurveTo(x,y,x+r,y);
  ctx.closePath();
}

function drawImageInFrame(ctx,src,x,y,w,h,r){
  return new Promise((resolve,reject)=>{
    const img=new Image();
    img.onload=function(){
      ctx.save(); roundRect(ctx,x,y,w,h,r); ctx.clip();
      const ratio=Math.max(w/img.width,h/img.height);
      const nw=img.width*ratio, nh=img.height*ratio;
      const dx=x+(w-nw)/2, dy=y+(h-nh)/2;
      ctx.drawImage(img,dx,dy,nw,nh); ctx.restore();
      ctx.lineWidth=6; ctx.strokeStyle='#87cefa'; roundRect(ctx,x,y,w,h,r); ctx.stroke();
      resolve();
    };
    img.onerror=reject; img.src=src;
  });
}

startBtn.onclick=takeThreeShots;
retakeBtn.onclick=takeThreeShots;
</script>
</body>
</html>
